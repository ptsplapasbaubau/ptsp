<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTSP LAPAS KELAS IIA BAUBAU</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a4d8c;
            --secondary-color: #e8a317;
            --accent-color: #2e6ab1;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --border-radius: 8px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1000;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 24px;
            font-weight: bold;
        }
        
        .logo-text h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            color: var(--dark-color);
        }
        
        .btn-primary:hover {
            background-color: #d18f0e;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-outline {
            background-color: transparent;
            color: white;
            border: 2px solid white;
        }
        
        .btn-outline:hover {
            background-color: white;
            color: var(--primary-color);
        }
        
        /* Navigation */
        nav {
            padding-top: 15px;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 5px 0;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--secondary-color);
            transition: var(--transition);
        }
        
        /* Hero Section */
        .hero {
            padding: 80px 0;
            background: linear-gradient(rgba(26, 77, 140, 0.9), rgba(26, 77, 140, 0.8)), url('https://images.unsplash.com/photo-1589829545856-d10d557cf95f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .hero h2 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
            opacity: 0.95;
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 60px;
            flex: 1;
        }
        
        /* Services Section */
        .services-section, .booking-section, .info-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .service-card {
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            transition: var(--transition);
        }
        
        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--accent-color);
        }
        
        .service-icon {
            width: 70px;
            height: 70px;
            background-color: #e8f0fe;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: var(--primary-color);
            font-size: 28px;
        }
        
        .service-card h3 {
            color: var(--dark-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        /* Booking Form */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(46, 106, 177, 0.2);
            outline: none;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .btn-submit {
            background-color: var(--primary-color);
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-submit:hover {
            background-color: var(--accent-color);
        }
        
        .btn-submit:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* Sidebar */
        .sidebar {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            height: fit-content;
        }
        
        .sidebar-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-list {
            list-style: none;
        }
        
        .info-list li {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .info-list li:last-child {
            border-bottom: none;
        }
        
        .info-list i {
            color: var(--secondary-color);
            margin-right: 10px;
        }
        
        /* Booking Result */
        .booking-result {
            display: none;
            background-color: #f0f8ff;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 25px;
            border-left: 5px solid var(--success-color);
        }
        
        .booking-code {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin: 15px 0;
            letter-spacing: 5px;
            font-family: monospace;
        }
        
        .barcode-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .barcode {
            font-family: monospace;
            font-size: 1.5rem;
            letter-spacing: 3px;
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px dashed #ccc;
            display: inline-block;
        }
        
        .instructions {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            font-size: 0.95rem;
        }
        
        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 50px 0 20px;
            margin-top: auto;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-section h3 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .contact-info p {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .contact-info i {
            margin-right: 10px;
            width: 20px;
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #444;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* Status Check Result */
        .status-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: var(--border-radius);
            display: none;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border-left: 5px solid var(--success-color);
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 5px solid var(--danger-color);
        }
        
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
            border-left: 5px solid var(--warning-color);
        }
        
        /* Loading Spinner */
        .fa-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .hero h2 {
                font-size: 2.2rem;
            }
        }
        
        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                gap: 20px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .services-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-top">
                <div class="logo-container">
                    <div class="logo">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <div class="logo-text">
                        <h1>PTSP LAPAS KELAS IIA BAUBAU</h1>
                        <p>Pelayanan Terpadu Satu Pintu - Lembaga Pemasyarakatan</p>
                    </div>
                </div>
                <div class="header-actions">
                    <a href="#booking" class="btn btn-primary">Daftar Kunjungan</a>
                    <a href="#services" class="btn btn-outline">Layanan</a>
                </div>
            </div>
            
            <nav>
                <ul class="nav-links">
                    <li><a href="#home"><i class="fas fa-home"></i> Beranda</a></li>
                    <li><a href="#services"><i class="fas fa-concierge-bell"></i> Layanan WBP</a></li>
                    <li><a href="#booking"><i class="fas fa-calendar-check"></i> Pendaftaran Online</a></li>
                    <li><a href="#info"><i class="fas fa-info-circle"></i> Informasi</a></li>
                    <li><a href="#contact"><i class="fas fa-phone-alt"></i> Kontak</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <h2>Pelayanan Terpadu LAPAS Kelas IIA Baubau</h2>
            <p>Memberikan kemudahan akses layanan informasi, kunjungan, dan titipan untuk keluarga Warga Binaan Pemasyarakatan (WBP) secara online dan terpadu.</p>
            <a href="#booking" class="btn btn-primary">Daftar Kunjungan Online Sekarang</a>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <div class="main-content">
            <div class="content-left">
                <!-- Services Section -->
                <section class="services-section" id="services">
                    <h2 class="section-title"><i class="fas fa-concierge-bell"></i> Layanan untuk WBP</h2>
                    <div class="services-grid">
                        <div class="service-card">
                            <div class="service-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3>Kunjungan Keluarga</h3>
                            <p>Layanan kunjungan keluarga dengan sistem pendaftaran online untuk mempersingkat waktu proses.</p>
                        </div>
                        
                        <div class="service-card">
                            <div class="service-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <h3>Titipan Paket</h3>
                            <p>Pengiriman paket barang untuk WBP dengan ketentuan dan jadwal yang telah ditentukan.</p>
                        </div>
                        
                        <div class="service-card">
                            <div class="service-icon">
                                <i class="fas fa-gavel"></i>
                            </div>
                            <h3>Bantuan Hukum</h3>
                            <p>Fasilitas akses bantuan hukum bagi WBP yang membutuhkan pendampingan hukum.</p>
                        </div>
                        
                        <div class="service-card">
                            <div class="service-icon">
                                <i class="fas fa-briefcase-medical"></i>
                            </div>
                            <h3>Layanan Kesehatan</h3>
                            <p>Pelayanan kesehatan dan pengobatan bagi WBP sesuai standar pelayanan kesehatan.</p>
                        </div>
                        
                        <div class="service-card">
                            <div class="service-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <h3>Pembinaan</h3>
                            <p>Program pembinaan kepribadian, keterampilan, dan pendidikan untuk persiapan kembali ke masyarakat.</p>
                        </div>
                        
                        <div class="service-card">
                            <div class="service-icon">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <h3>Pembebasan Bersyarat</h3>
                            <p>Informasi dan persyaratan untuk pengajuan pembebasan bersyarat bagi WBP yang memenuhi kriteria.</p>
                        </div>
                    </div>
                </section>
                
                <!-- Booking Section -->
                <section class="booking-section" id="booking">
                    <h2 class="section-title"><i class="fas fa-calendar-check"></i> Pendaftaran Kunjungan Online</h2>
                    <p>Isi formulir pendaftaran di bawah ini untuk mendapatkan kode booking kunjungan. Tunjukkan kode booking saat datang ke LAPAS untuk proses yang lebih cepat.</p>
                    
                    <form id="bookingForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nama">Nama Lengkap <span style="color: var(--danger-color)">*</span></label>
                                <input type="text" id="nama" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="nik">NIK <span style="color: var(--danger-color)">*</span></label>
                                <input type="text" id="nik" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="telepon">No. Telepon <span style="color: var(--danger-color)">*</span></label>
                                <input type="tel" id="telepon" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" class="form-control">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hubungan">Hubungan dengan WBP <span style="color: var(--danger-color)">*</span></label>
                                <select id="hubungan" class="form-control" required>
                                    <option value="">Pilih Hubungan</option>
                                    <option value="Keluarga Inti">Keluarga Inti (Suami/Istri/Anak)</option>
                                    <option value="Orang Tua">Orang Tua</option>
                                    <option value="Saudara Kandung">Saudara Kandung</option>
                                    <option value="Keluarga Lain">Keluarga Lain</option>
                                    <option value="Pengacara">Pengacara</option>
                                    <option value="Lainnya">Lainnya</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="tanggal">Tanggal Kunjungan <span style="color: var(--danger-color)">*</span></label>
                                <input type="date" id="tanggal" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="namaWbp">Nama WBP yang Akan Dikunjungi <span style="color: var(--danger-color)">*</span></label>
                            <input type="text" id="namaWbp" class="form-control" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="statusWbp">Status WBP <span style="color: var(--danger-color)">*</span></label>
                                <select id="statusWbp" class="form-control" required>
                                    <option value="">Pilih Status</option>
                                    <option value="Narapidana">Narapidana</option>
                                    <option value="Tahanan">Tahanan</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="jenisKunjungan">Jenis Layanan <span style="color: var(--danger-color)">*</span></label>
                                <select id="jenisKunjungan" class="form-control" required>
                                    <option value="">Pilih Layanan</option>
                                    <option value="Kunjungan Keluarga">Kunjungan Keluarga</option>
                                    <option value="Titipan Paket">Titipan Paket</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-submit" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> Daftarkan Kunjungan
                        </button>
                    </form>
                    
                    <div class="booking-result" id="bookingResult">
                        <h3 style="color: var(--success-color); margin-bottom: 15px;">
                            <i class="fas fa-check-circle"></i> Pendaftaran Berhasil!
                        </h3>
                        <p>Pendaftaran kunjungan Anda telah berhasil. Silakan catat kode booking berikut dan tunjukkan saat datang ke LAPAS Kelas IIA Baubau.</p>
                        
                        <div class="booking-code" id="bookingCodeDisplay">PTSP-BAU-XXXXXX</div>
                        
                        <div class="barcode-container">
                            <div class="barcode" id="barcodeDisplay">|| | | || | || | | ||</div>
                        </div>
                        
                        <div class="instructions">
                            <h4><i class="fas fa-info-circle"></i> Instruksi Penting:</h4>
                            <ul style="margin-top: 10px; padding-left: 20px;">
                                <li>Tunjukkan kode booking di atas kepada petugas pendaftaran saat datang ke LAPAS</li>
                                <li>Datang 30 menit sebelum waktu kunjungan yang dijadwalkan</li>
                                <li>Bawa dokumen identitas asli (KTP) untuk verifikasi</li>
                                <li>Patuhi semua peraturan dan tata tertib LAPAS selama kunjungan</li>
                                <li>Kode booking ini berlaku hanya untuk satu kali kunjungan</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="window.print()">
                                <i class="fas fa-print"></i> Cetak Halaman
                            </button>
                            <button class="btn btn-outline" style="color: var(--primary-color); border-color: var(--primary-color);" onclick="sendToEmail()">
                                <i class="fas fa-envelope"></i> Kirim ke Email
                            </button>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Sidebar -->
            <div class="sidebar">
                <h3 class="sidebar-title"><i class="fas fa-info-circle"></i> Informasi Penting</h3>
                <ul class="info-list">
                    <li><i class="fas fa-clock"></i> <strong>Jam Kunjungan:</strong><br>Senin-Jumat: 09.00-15.00 WITA</li>
                    <li><i class="fas fa-exclamation-triangle"></i> <strong>Syarat Kunjungan:</strong><br>Membawa KTP asli, maksimal 3 orang per kunjungan</li>
                    <li><i class="fas fa-box"></i> <strong>Titipan Paket:</strong><br>Hari Selasa & Kamis, pukul 10.00-12.00 WITA</li>
                    <li><i class="fas fa-user-shield"></i> <strong>Protokol Kesehatan:</strong><br>Wajib masker, pengecekan suhu, dan jaga jarak</li>
                    <li><i class="fas fa-phone"></i> <strong>Kontak Darurat:</strong><br>(0402) 1234567 ext. 102</li>
                </ul>
                
                <div style="margin-top: 30px; background-color: #e8f0fe; padding: 20px; border-radius: var(--border-radius);">
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;">
                        <i class="fas fa-search"></i> Cek Status Pendaftaran
                    </h4>
                    <p style="margin-bottom: 15px; font-size: 0.95rem;">Masukkan kode booking untuk mengecek status pendaftaran Anda</p>
                    <input type="text" id="cekKode" class="form-control" placeholder="Masukkan kode booking" style="margin-bottom: 10px;">
                    <button class="btn btn-primary" style="width: 100%;" onclick="cekStatusBooking()">
                        <i class="fas fa-search"></i> Cek Status
                    </button>
                    <div class="status-result" id="statusResult"></div>
                </div>
                
                <div id="apiStatus" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: var(--border-radius); text-align: center;">
                    <small><i class="fas fa-sync fa-spin"></i> Memeriksa koneksi...</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>PTSP LAPAS Kelas IIA Baubau</h3>
                    <p>Sistem Pelayanan Terpadu Satu Pintu Lembaga Pemasyarakatan Kelas IIA Baubau untuk memberikan kemudahan akses layanan informasi dan administrasi bagi keluarga Warga Binaan Pemasyarakatan.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Kontak Kami</h3>
                    <div class="contact-info">
                        <p><i class="fas fa-map-marker-alt"></i> Jl. Sultan Hasanuddin No. 45, Baubau, Sulawesi Tenggara</p>
                        <p><i class="fas fa-phone"></i> (0402) 1234567</p>
                        <p><i class="fas fa-fax"></i> (0402) 1234568</p>
                        <p><i class="fas fa-envelope"></i> ptsp@lapasbaubau.go.id</p>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Link Cepat</h3>
                    <ul style="list-style: none;">
                        <li style="margin-bottom: 10px;"><a href="#home" style="color: white; text-decoration: none;"><i class="fas fa-chevron-right"></i> Beranda</a></li>
                        <li style="margin-bottom: 10px;"><a href="#services" style="color: white; text-decoration: none;"><i class="fas fa-chevron-right"></i> Layanan WBP</a></li>
                        <li style="margin-bottom: 10px;"><a href="#booking" style="color: white; text-decoration: none;"><i class="fas fa-chevron-right"></i> Pendaftaran Online</a></li>
                        <li style="margin-bottom: 10px;"><a href="#info" style="color: white; text-decoration: none;"><i class="fas fa-chevron-right"></i> Informasi</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 PTSP LAPAS Kelas IIA Baubau. Semua hak dilindungi.</p>
            </div>
        </div>
    </footer>

    <script>
        // ============================================
        // PTSP LAPAS BAUBAU - JAVASCRIPT
        // ============================================
        
        // ================= KONFIGURASI =================
        // URL Google Apps Script Anda
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyQqk1Yh_4t8KvJm7Xz6Ld9rT2pN5bWcVxZ3BjDfGhRnMlPoIiKuHnYtS/exec';
        
        // ================= INISIALISASI =================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Aplikasi PTSP Lapas Baubau dimuat');
            
            // Setup form tanggal
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggal').min = today;
            
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('tanggal').value = tomorrow.toISOString().split('T')[0];
            
            // Test koneksi API
            testAPIConnection();
            
            // Load data dari localStorage
            loadLocalData();
        });
        
        // ================= FUNGSI BANTUAN =================
        function generateBookingCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = 'PTSP-BAU-';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        function generateBarcode(code) {
            const chars = '‚ñà‚ñì‚ñí‚ñë‚ñÑ‚ñÄ‚ñ†';
            let barcode = '';
            for (let i = 0; i < 20; i++) {
                const hash = code.charCodeAt(i % code.length);
                barcode += chars[hash % chars.length];
            }
            return barcode;
        }
        
        // ================= TEST KONEKSI API =================
        async function testAPIConnection() {
            const statusEl = document.getElementById('apiStatus');
            
            try {
                statusEl.innerHTML = '<small><i class="fas fa-sync fa-spin"></i> Memeriksa koneksi...</small>';
                
                // Gunakan JSONP untuk test
                const testResult = await jsonpRequest(GAS_URL, { action: 'test' });
                
                if (testResult && testResult.status === 'Online') {
                    statusEl.innerHTML = '<small><i class="fas fa-check-circle" style="color: var(--success-color);"></i> Koneksi server: ONLINE</small>';
                    console.log('‚úÖ API Connected:', testResult);
                    return true;
                } else {
                    statusEl.innerHTML = '<small><i class="fas fa-exclamation-triangle" style="color: var(--warning-color);"></i> Koneksi server: LIMITED</small>';
                    return false;
                }
            } catch (error) {
                statusEl.innerHTML = '<small><i class="fas fa-times-circle" style="color: var(--danger-color);"></i> Koneksi server: OFFLINE</small>';
                console.warn('‚ö†Ô∏è API Offline:', error.message);
                return false;
            }
        }
        
        // ================= JSONP REQUEST =================
        function jsonpRequest(url, params = {}) {
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonp_callback_' + Date.now() + '_' + Math.random().toString(36).substr(2);
                
                // Setup callback
                window[callbackName] = function(response) {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                    resolve(response);
                };
                
                // Build URL dengan callback
                const urlParams = new URLSearchParams(params);
                urlParams.append('callback', callbackName);
                
                const script = document.createElement('script');
                script.src = url + '?' + urlParams.toString() + '&_=' + Date.now();
                
                script.onerror = function() {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                    reject(new Error('JSONP request failed'));
                };
                
                document.head.appendChild(script);
                
                // Timeout
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        reject(new Error('JSONP timeout'));
                    }
                }, 10000);
            });
        }
        
        // ================= FORM HANDLER =================
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            console.log('üìù Form submitted');
            
            // Validasi form
            if (!validateForm()) {
                showAlert('Harap isi semua field yang wajib diisi!', 'error');
                return;
            }
            
            // Tampilkan loading
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            submitBtn.disabled = true;
            
            try {
                // Ambil data form
                const formData = {
                    nama: document.getElementById('nama').value.trim(),
                    nik: document.getElementById('nik').value.trim(),
                    telepon: document.getElementById('telepon').value.trim(),
                    email: document.getElementById('email').value.trim() || '-',
                    hubungan: document.getElementById('hubungan').value,
                    tanggal: document.getElementById('tanggal').value,
                    namaWbp: document.getElementById('namaWbp').value.trim(),
                    statusWbp: document.getElementById('statusWbp').value,
                    jenisKunjungan: document.getElementById('jenisKunjungan').value,
                    timestamp: new Date().toISOString()
                };
                
                // Generate booking code
                const bookingCode = generateBookingCode();
                
                console.log('üìä Data yang akan dikirim:', formData);
                console.log('üé´ Kode Booking:', bookingCode);
                
                // Coba kirim ke server via JSONP
                let serverSuccess = false;
                let serverResponse = null;
                
                try {
                    serverResponse = await jsonpRequest(GAS_URL, {
                        data: JSON.stringify({
                            ...formData,
                            bookingCode: bookingCode
                        })
                    });
                    
                    if (serverResponse && serverResponse.success) {
                        serverSuccess = true;
                        console.log('‚úÖ Data berhasil dikirim ke server:', serverResponse);
                    }
                } catch (serverError) {
                    console.warn('‚ö†Ô∏è Gagal mengirim ke server:', serverError);
                }
                
                // Simpan ke localStorage (selalu)
                const localSaveResult = saveToLocalStorage(formData, bookingCode, serverSuccess);
                
                // Tampilkan hasil
                showBookingResult(bookingCode, serverSuccess, serverResponse);
                
                // Reset form
                resetForm();
                
                // Show success message
                if (serverSuccess) {
                    showAlert(`‚úÖ Pendaftaran berhasil! Kode booking: ${bookingCode}`, 'success');
                } else {
                    showAlert(`‚ö†Ô∏è Pendaftaran berhasil (Mode Offline)! Kode: ${bookingCode}`, 'warning');
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                showAlert('Terjadi kesalahan. Silakan coba lagi.', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });
        
        // ================= SIMPAN KE LOCALSTORAGE =================
        function saveToLocalStorage(formData, bookingCode, serverSuccess) {
            try {
                const bookingRecord = {
                    id: Date.now(),
                    ...formData,
                    bookingCode: bookingCode,
                    serverSynced: serverSuccess,
                    localTimestamp: new Date().toISOString(),
                    status: serverSuccess ? 'TERKIRIM_KE_SERVER' : 'DISIMPAN_LOKAL'
                };
                
                // Ambil data yang ada
                const existingBookings = JSON.parse(localStorage.getItem('ptsp_bookings') || '[]');
                
                // Tambah data baru
                existingBookings.push(bookingRecord);
                
                // Simpan kembali
                localStorage.setItem('ptsp_bookings', JSON.stringify(existingBookings));
                
                console.log('üíæ Disimpan di localStorage:', bookingRecord);
                console.log('üìä Total data di localStorage:', existingBookings.length);
                
                // Coba sync data lokal yang belum tersinkron
                syncLocalData();
                
                return true;
            } catch (error) {
                console.error('‚ùå Gagal menyimpan ke localStorage:', error);
                return false;
            }
        }
        
        // ================= SYNC DATA LOKAL =================
        async function syncLocalData() {
            try {
                const bookings = JSON.parse(localStorage.getItem('ptsp_bookings') || '[]');
                const unsynced = bookings.filter(b => !b.serverSynced);
                
                if (unsynced.length === 0) return;
                
                console.log(`üîÑ Mencoba sync ${unsynced.length} data lokal...`);
                
                for (const booking of unsynced) {
                    try {
                        const response = await jsonpRequest(GAS_URL, {
                            data: JSON.stringify({
                                nama: booking.nama,
                                nik: booking.nik,
                                telepon: booking.telepon,
                                email: booking.email,
                                hubungan: booking.hubungan,
                                tanggal: booking.tanggal,
                                namaWbp: booking.namaWbp,
                                statusWbp: booking.statusWbp,
                                jenisKunjungan: booking.jenisKunjungan,
                                bookingCode: booking.bookingCode
                            })
                        });
                        
                        if (response && response.success) {
                            // Update status di localStorage
                            booking.serverSynced = true;
                            booking.status = 'TERKIRIM_KE_SERVER';
                            booking.syncTimestamp = new Date().toISOString();
                            console.log(`‚úÖ Data ${booking.bookingCode} berhasil disync`);
                        }
                    } catch (error) {
                        console.log(`‚ö†Ô∏è Gagal sync ${booking.bookingCode}:`, error.message);
                        break; // Stop jika gagal
                    }
                }
                
                // Update localStorage
                localStorage.setItem('ptsp_bookings', JSON.stringify(bookings));
                
            } catch (error) {
                console.error('‚ùå Error syncing data:', error);
            }
        }
        
        // ================= LOAD DATA LOKAL =================
        function loadLocalData() {
            try {
                const bookings = JSON.parse(localStorage.getItem('ptsp_bookings') || '[]');
                console.log('üìÅ Data lokal yang tersimpan:', bookings.length, 'records');
                
                // Update status display jika ada data offline
                const offlineCount = bookings.filter(b => !b.serverSynced).length;
                if (offlineCount > 0) {
                    const statusEl = document.getElementById('apiStatus');
                    statusEl.innerHTML += `<br><small><i class="fas fa-database"></i> ${offlineCount} data offline menunggu sync</small>`;
                }
                
                return bookings;
            } catch (error) {
                console.error('‚ùå Error loading local data:', error);
                return [];
            }
        }
        
        // ================= TAMPILKAN HASIL =================
        function showBookingResult(bookingCode, serverSuccess, serverResponse = null) {
            const bookingResult = document.getElementById('bookingResult');
            const bookingCodeDisplay = document.getElementById('bookingCodeDisplay');
            const barcodeDisplay = document.getElementById('barcodeDisplay');
            
            // Update tampilan
            bookingCodeDisplay.textContent = bookingCode;
            barcodeDisplay.textContent = generateBarcode(bookingCode);
            
            // Update status message
            const statusTitle = bookingResult.querySelector('h3');
            if (serverSuccess) {
                statusTitle.innerHTML = '<i class="fas fa-check-circle"></i> Pendaftaran Berhasil (Online)!';
                statusTitle.style.color = 'var(--success-color)';
                
                // Tambah info server
                if (serverResponse && serverResponse.row) {
                    const instructions = document.querySelector('.instructions');
                    instructions.innerHTML += `
                        <div style="margin-top: 10px; padding: 10px; background: #d4edda; border-radius: 4px;">
                            <i class="fas fa-server"></i> <strong>Data tersimpan di server:</strong><br>
                            Row: ${serverResponse.row} | Timestamp: ${new Date().toLocaleString()}
                        </div>
                    `;
                }
            } else {
                statusTitle.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Pendaftaran Berhasil (Offline Mode)';
                statusTitle.style.color = 'var(--warning-color)';
                
                // Tambah note offline
                const instructions = document.querySelector('.instructions');
                instructions.innerHTML += `
                    <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 4px;">
                        <i class="fas fa-info-circle"></i> <strong>Mode Offline:</strong><br>
                        Data disimpan sementara di browser. Akan otomatis disinkronkan saat koneksi tersedia.
                    </div>
                `;
            }
            
            // Tampilkan hasil
            bookingResult.style.display = 'block';
            
            // Scroll ke hasil
            bookingResult.scrollIntoView({ behavior: 'smooth' });
        }
        
        // ================= VALIDASI FORM =================
        function validateForm() {
            const requiredFields = [
                'nama', 'nik', 'telepon', 'hubungan', 
                'tanggal', 'namaWbp', 'statusWbp', 'jenisKunjungan'
            ];
            
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    isValid = false;
                    field.style.borderColor = 'var(--danger-color)';
                    field.style.boxShadow = '0 0 0 2px rgba(220, 53, 69, 0.2)';
                } else {
                    field.style.borderColor = '#ddd';
                    field.style.boxShadow = 'none';
                }
            });
            
            // Validasi NIK
            const nik = document.getElementById('nik').value.trim();
            if (nik && nik.length < 16) {
                showAlert('NIK harus minimal 16 digit', 'warning');
                document.getElementById('nik').style.borderColor = 'var(--warning-color)';
                isValid = false;
            }
            
            // Validasi telepon
            const telepon = document.getElementById('telepon').value.trim();
            if (telepon && telepon.length < 10) {
                showAlert('Nomor telepon minimal 10 digit', 'warning');
                document.getElementById('telepon').style.borderColor = 'var(--warning-color)';
                isValid = false;
            }
            
            return isValid;
        }
        
        // ================= RESET FORM =================
        function resetForm() {
            document.getElementById('bookingForm').reset();
            
            // Set tanggal ke besok lagi
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('tanggal').value = tomorrow.toISOString().split('T')[0];
            
            // Reset styles
            const fields = document.querySelectorAll('.form-control');
            fields.forEach(field => {
                field.style.borderColor = '#ddd';
                field.style.boxShadow = 'none';
            });
        }
        
        // ================= CEK STATUS BOOKING =================
        async function cekStatusBooking() {
            const bookingCode = document.getElementById('cekKode').value.trim();
            const statusResult = document.getElementById('statusResult');
            
            if (!bookingCode) {
                showAlert('Masukkan kode booking terlebih dahulu!', 'warning');
                return;
            }
            
            // Tampilkan loading
            statusResult.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Mencari data...</p>';
            statusResult.className = 'status-result status-success';
            statusResult.style.display = 'block';
            
            try {
                // Cek di localStorage dulu
                const bookings = JSON.parse(localStorage.getItem('ptsp_bookings') || '[]');
                const localBooking = bookings.find(b => b.bookingCode === bookingCode);
                
                if (localBooking) {
                    statusResult.innerHTML = `
                        <h4><i class="fas fa-check-circle"></i> Data Ditemukan (Local)</h4>
                        <p><strong>Kode Booking:</strong> ${localBooking.bookingCode}</p>
                        <p><strong>Nama:</strong> ${localBooking.nama}</p>
                        <p><strong>Tanggal Kunjungan:</strong> ${new Date(localBooking.tanggal).toLocaleDateString('id-ID')}</p>
                        <p><strong>Nama WBP:</strong> ${localBooking.namaWbp}</p>
                        <p><strong>Status Server:</strong> ${localBooking.serverSynced ? 
                            '<span style="color: var(--success-color);">TERKIRIM KE SERVER</span>' : 
                            '<span style="color: var(--warning-color);">DISIMPAN LOKAL</span>'}</p>
                        <p><strong>Tanggal Pendaftaran:</strong> ${new Date(localBooking.localTimestamp).toLocaleString('id-ID')}</p>
                    `;
                    statusResult.className = 'status-result status-success';
                    return;
                }
                
                // Cek di server
                console.log('üîç Mencari di server:', bookingCode);
                
                const serverResult = await jsonpRequest(GAS_URL, {
                    action: 'getBookingStatus',
                    bookingCode: bookingCode
                });
                
                if (serverResult && serverResult.found) {
                    statusResult.innerHTML = `
                        <h4><i class="fas fa-check-circle"></i> Data Ditemukan (Server)</h4>
                        <p><strong>Kode Booking:</strong> ${serverResult.bookingCode}</p>
                        <p><strong>Nama:</strong> ${serverResult.nama || '-'}</p>
                        <p><strong>Tanggal Kunjungan:</strong> ${serverResult.tanggalKunjungan || '-'}</p>
                        <p><strong>Status:</strong> <span style="color: var(--success-color);">${serverResult.status || 'MENUNGGU VERIFIKASI'}</span></p>
                        <p><strong>Pesan:</strong> ${serverResult.message || 'Data ditemukan di sistem'}</p>
                    `;
                    statusResult.className = 'status-result status-success';
                } else {
                    statusResult.innerHTML = `
                        <p><i class="fas fa-exclamation-triangle"></i> Kode booking tidak ditemukan</p>
                        <p><small>Pastikan kode booking yang dimasukkan benar</small></p>
                    `;
                    statusResult.className = 'status-result status-error';
                }
                
            } catch (error) {
                console.error('‚ùå Error checking status:', error);
                statusResult.innerHTML = `
                    <p><i class="fas fa-exclamation-triangle"></i> Tidak dapat menghubungi server</p>
                    <p><small>Coba lagi nanti atau gunakan kode dari pendaftaran offline</small></p>
                `;
                statusResult.className = 'status-result status-error';
            }
        }
        
        // ================= FUNGSI TAMBAHAN =================
        function sendToEmail() {
            const email = document.getElementById('email').value;
            const bookingCode = document.getElementById('bookingCodeDisplay').textContent;
            
            let targetEmail = email;
            
            if (!targetEmail || targetEmail === '-') {
                targetEmail = prompt('Masukkan email untuk mengirim konfirmasi:', '');
                if (!targetEmail) return;
            }
            
            // Simulasi pengiriman email
            const subject = 'Konfirmasi Pendaftaran Kunjungan - PTSP Lapas Baubau';
            const body = `
Kode Booking: ${bookingCode}
Tanggal: ${new Date().toLocaleDateString('id-ID')}
Status: Pendaftaran Berhasil

Simpan email ini sebagai bukti pendaftaran.
            `.trim();
            
            // Buat mailto link
            const mailtoLink = `mailto:${targetEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Buka client email
            window.location.href = mailtoLink;
            
            // Fallback alert
            setTimeout(() => {
                alert(`Konfirmasi kode booking ${bookingCode} siap dikirim ke ${targetEmail}`);
            }, 1000);
        }
        
        function showAlert(message, type = 'info') {
            // Buat alert element
            const alertEl = document.createElement('div');
            alertEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: var(--border-radius);
                color: white;
                font-weight: 500;
                z-index: 9999;
                min-width: 300px;
                max-width: 400px;
                box-shadow: var(--box-shadow);
                animation: slideIn 0.3s ease;
            `;
            
            // Set color berdasarkan type
            switch(type) {
                case 'success':
                    alertEl.style.backgroundColor = 'var(--success-color)';
                    break;
                case 'warning':
                    alertEl.style.backgroundColor = 'var(--warning-color)';
                    break;
                case 'error':
                    alertEl.style.backgroundColor = 'var(--danger-color)';
                    break;
                default:
                    alertEl.style.backgroundColor = 'var(--primary-color)';
            }
            
            alertEl.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // Tambah ke body
            document.body.appendChild(alertEl);
            
            // Hapus setelah 5 detik
            setTimeout(() => {
                alertEl.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (alertEl.parentNode) {
                        alertEl.parentNode.removeChild(alertEl);
                    }
                }, 300);
            }, 5000);
            
            // Tambah animation styles
            if (!document.querySelector('#alertAnimations')) {
                const style = document.createElement('style');
                style.id = 'alertAnimations';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // Smooth scrolling untuk navigasi
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 100,
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // Auto-hide status result setelah 10 detik
        setInterval(() => {
            const statusResult = document.getElementById('statusResult');
            if (statusResult.style.display === 'block') {
                const displayedTime = parseInt(statusResult.getAttribute('data-display-time') || '0');
                if (displayedTime > 10) {
                    statusResult.style.display = 'none';
                } else {
                    statusResult.setAttribute('data-display-time', displayedTime + 1);
                }
            }
        }, 1000);
        
        // Export data lokal (untuk admin/debug)
        window.exportLocalData = function() {
            const bookings = JSON.parse(localStorage.getItem('ptsp_bookings') || '[]');
            const dataStr = JSON.stringify(bookings, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'ptsp_data_backup.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            console.log('üì• Data diexport:', bookings.length, 'records');
            showAlert(`Data berhasil diexport (${bookings.length} records)`, 'success');
        };
        
        // Clear data lokal (hati-hati!)
        window.clearLocalData = function() {
            if (confirm('Hapus semua data lokal? Data di server tidak akan terpengaruh.')) {
                localStorage.removeItem('ptsp_bookings');
                showAlert('Data lokal telah dihapus', 'warning');
                console.log('üóëÔ∏è Data lokal dihapus');
            }
        };
        
        // Log untuk debugging
        console.log('‚ú® Aplikasi siap digunakan');
        console.log('üåê GAS URL:', GAS_URL);
        console.log('üì± Mode:', window.location.protocol === 'file:' ? 'Local File' : 'Web');
    </script>
</body>
</html>
